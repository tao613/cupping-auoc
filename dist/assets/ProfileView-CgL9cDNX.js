import{r as P,X as L,c as g,w as T,y as d,J as b,z as u,A as e,V as E,I as r,aE as D,M as f,C as q,D as k,L as j,k as O,P as Y,O as G,a6 as H,ak as p,aD as J}from"./vue-vendor-BT5MiFnI.js";import{_ as I,u as Z,a as F}from"./index-BLlFbjoM.js";const Q={class:"dialog-content"},X={class:"field-group"},K={class:"password-input-wrapper"},R=["type"],W={class:"material-icons"},ee={class:"field-group"},se={class:"password-input-wrapper"},te=["type"],ae={class:"material-icons"},oe={class:"password-strength"},le={class:"strength-bar"},ie={class:"strength-text"},re={class:"field-group"},ne={class:"password-input-wrapper"},de=["type"],ue={class:"material-icons"},ce={key:0,class:"error-message"},pe={class:"password-tips"},ve={class:"dialog-actions"},me=["disabled"],fe={key:0,class:"material-icons loading-icon"},we={__name:"ChangePasswordDialog",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup($,{emit:C}){const h=$,w=C,U=Z(),y=F(),v=P(!1),i=P(!1),t=P(!1),_=P(!1),l=L({currentPassword:"",newPassword:"",confirmPassword:""}),x=g(()=>{const m=l.newPassword;let a=0,n="weak",A="弱";return m.length>=6&&(a+=1),m.match(/[a-zA-Z]/)&&(a+=1),m.match(/[0-9]/)&&(a+=1),m.match(/[^a-zA-Z0-9]/)&&(a+=1),m.length>=12&&(a+=1),a>=4?(n="strong",A="强"):a>=2&&(n="medium",A="中等"),{level:n,text:A,percentage:a/5*100}}),V=g(()=>l.newPassword.length>=6),S=g(()=>/[a-zA-Z]/.test(l.newPassword)),z=g(()=>/[0-9]/.test(l.newPassword)),c=g(()=>/[^a-zA-Z0-9]/.test(l.newPassword)),s=g(()=>l.newPassword===l.confirmPassword),o=g(()=>l.currentPassword&&l.newPassword&&l.confirmPassword&&V.value&&s.value);T(()=>h.modelValue,m=>{m&&M()});const M=()=>{l.currentPassword="",l.newPassword="",l.confirmPassword="",i.value=!1,t.value=!1,_.value=!1},N=()=>{w("update:modelValue",!1)},B=async()=>{if(!(!o.value||v.value)){v.value=!0;try{await U.changePassword({current_password:l.currentPassword,new_password:l.newPassword}),y.showNotification({type:"success",message:"密码修改成功"}),w("success"),N()}catch(m){y.showNotification({type:"error",message:m.message||"密码修改失败，请重试"})}finally{v.value=!1}}};return(m,a)=>$.modelValue?(u(),d("div",{key:0,class:"dialog-overlay",onClick:N},[e("div",{class:"dialog-container",onClick:a[6]||(a[6]=E(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[a[8]||(a[8]=e("h2",null,"修改密码",-1)),e("button",{class:"close-button",onClick:N},a[7]||(a[7]=[e("i",{class:"material-icons"},"close",-1)]))]),e("div",Q,[e("form",{onSubmit:E(B,["prevent"]),class:"password-form"},[e("div",X,[a[9]||(a[9]=e("label",{class:"field-label"},"当前密码",-1)),e("div",K,[r(e("input",{"onUpdate:modelValue":a[0]||(a[0]=n=>l.currentPassword=n),type:i.value?"text":"password",class:"field-input",placeholder:"请输入当前密码",required:""},null,8,R),[[D,l.currentPassword]]),e("button",{type:"button",class:"password-toggle",onClick:a[1]||(a[1]=n=>i.value=!i.value)},[e("i",W,f(i.value?"visibility_off":"visibility"),1)])])]),e("div",ee,[a[10]||(a[10]=e("label",{class:"field-label"},"新密码",-1)),e("div",se,[r(e("input",{"onUpdate:modelValue":a[2]||(a[2]=n=>l.newPassword=n),type:t.value?"text":"password",class:"field-input",placeholder:"请输入新密码（至少6位）",minlength:"6",required:""},null,8,te),[[D,l.newPassword]]),e("button",{type:"button",class:"password-toggle",onClick:a[3]||(a[3]=n=>t.value=!t.value)},[e("i",ae,f(t.value?"visibility_off":"visibility"),1)])]),e("div",oe,[e("div",le,[e("div",{class:k(["strength-fill",x.value.level]),style:q({width:x.value.percentage+"%"})},null,6)]),e("span",ie,f(x.value.text),1)])]),e("div",re,[a[11]||(a[11]=e("label",{class:"field-label"},"确认新密码",-1)),e("div",ne,[r(e("input",{"onUpdate:modelValue":a[4]||(a[4]=n=>l.confirmPassword=n),type:_.value?"text":"password",class:"field-input",placeholder:"请再次输入新密码",required:""},null,8,de),[[D,l.confirmPassword]]),e("button",{type:"button",class:"password-toggle",onClick:a[5]||(a[5]=n=>_.value=!_.value)},[e("i",ue,f(_.value?"visibility_off":"visibility"),1)])]),l.confirmPassword&&!s.value?(u(),d("div",ce," 两次输入的密码不一致 ")):b("",!0)]),e("div",pe,[a[12]||(a[12]=e("h4",null,"密码要求：",-1)),e("ul",null,[e("li",{class:k({valid:V.value})},"至少6位字符",2),e("li",{class:k({valid:S.value})},"包含字母",2),e("li",{class:k({valid:z.value})},"包含数字",2),e("li",{class:k({valid:c.value})},"包含特殊字符（推荐）",2)])])],32)]),e("div",ve,[e("button",{type:"button",class:"cancel-button",onClick:N}," 取消 "),e("button",{type:"submit",class:"submit-button",disabled:!o.value||v.value,onClick:B},[v.value?(u(),d("i",fe,"hourglass_empty")):b("",!0),j(" "+f(v.value?"修改中...":"确认修改"),1)],8,me)])])])):b("",!0)}},ye=I(we,[["__scopeId","data-v-007650ef"]]),ge={class:"settings-view"},be={class:"settings-container"},he={class:"tab-navigation"},_e=["onClick"],Pe={class:"tab-content"},ke={key:0,class:"tab-pane"},Ce={class:"profile-form"},xe={class:"avatar-section"},Ve={class:"avatar-wrapper"},Ne={class:"avatar"},$e=["src","alt"],Ue={key:1,class:"avatar-placeholder"},Se={class:"user-info"},ze={class:"user-name"},Ae={class:"user-role"},De={class:"form-section"},Ee={class:"form-row"},Me={class:"form-group"},Be={class:"form-group"},Le={class:"form-group"},je={class:"form-group"},Ie={class:"form-row"},Ze={class:"form-group"},Fe={class:"form-group"},Te={class:"form-row"},qe={class:"form-group"},Oe={class:"form-group"},Ye={class:"form-row"},Ge={class:"form-group"},He={class:"form-group"},Je={class:"form-group"},Qe={class:"form-actions"},Xe=["disabled"],Ke={key:0,class:"loading-spinner"},Re={key:1,class:"tab-pane"},We={key:2,class:"tab-pane"},es={key:3,class:"tab-pane"},ss={__name:"ProfileView",setup($){const C=Z(),h=F(),w=P("profile"),U=[{key:"profile",label:"Edit Profile"},{key:"preferences",label:"Preferences"},{key:"security",label:"Security"},{key:"privacy",label:"Data Privacy"}],y=P(!1),v=P(!1),i=g(()=>C.user),t=L({firstName:"",lastName:"",name:"",username:"",email:"",phone:"",country:"",city:"",address:"",zipCode:"",certification_level:"",experience_years:null,bio:"",avatar:""});O(()=>{_()});const _=async()=>{try{await C.refreshUserInfo();const s=(i.value.name||"").split(" ");Object.assign(t,{firstName:s[0]||"",lastName:s.slice(1).join(" ")||"",name:i.value.name||"",username:i.value.username||"",email:i.value.email||"",phone:i.value.phone||"",country:i.value.country||"",city:i.value.city||"",address:i.value.address||"",zipCode:i.value.zipCode||"",certification_level:i.value.certification_level||"",experience_years:i.value.experience_years||null,bio:i.value.bio||"",avatar:i.value.avatar||""})}catch{h.showNotification({type:"error",message:"Failed to load user information"})}},l=async()=>{y.value=!0;try{const c=`${t.firstName} ${t.lastName}`.trim(),s={...t,name:c};await C.updateProfile(s),h.showNotification({type:"success",message:"Profile updated successfully"})}catch(c){h.showNotification({type:"error",message:c.message||"Update failed, please try again"})}finally{y.value=!1}},x=()=>{h.showNotification({type:"info",message:"Avatar upload feature coming soon"})},V=()=>{v.value=!0},S=()=>{h.showNotification({type:"success",message:"Password changed successfully"})},z=c=>c?c.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().slice(0,2):"U";return(c,s)=>(u(),d("div",ge,[e("div",be,[s[30]||(s[30]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"Setting")],-1)),e("div",he,[(u(),d(G,null,H(U,o=>e("button",{key:o.key,class:k(["tab-button",{active:w.value===o.key}]),onClick:M=>w.value=o.key},f(o.label),11,_e)),64))]),e("div",Pe,[w.value==="profile"?(u(),d("div",ke,[e("div",Ce,[e("div",xe,[e("div",Ve,[e("div",Ne,[t.avatar?(u(),d("img",{key:0,src:t.avatar,alt:t.name||"User Avatar"},null,8,$e)):(u(),d("div",Ue,f(z(t.name||i.value.name)),1))]),e("button",{class:"avatar-edit-btn",onClick:x},s[12]||(s[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),e("circle",{cx:"12",cy:"13",r:"4"})],-1)]))]),e("div",Se,[e("h3",ze,f(t.name||i.value.name||"User"),1),e("p",Ae,f(t.certification_level||"Coffee Enthusiast"),1)])]),e("div",De,[e("form",{onSubmit:E(l,["prevent"])},[e("div",Ee,[e("div",Me,[s[13]||(s[13]=e("label",{class:"form-label"},"First Name",-1)),r(e("input",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.firstName=o),type:"text",class:"form-input",placeholder:"Enter first name"},null,512),[[p,t.firstName]])]),e("div",Be,[s[14]||(s[14]=e("label",{class:"form-label"},"Last Name",-1)),r(e("input",{"onUpdate:modelValue":s[1]||(s[1]=o=>t.lastName=o),type:"text",class:"form-input",placeholder:"Enter last name"},null,512),[[p,t.lastName]])])]),e("div",Le,[s[15]||(s[15]=e("label",{class:"form-label"},"Email Address",-1)),r(e("input",{"onUpdate:modelValue":s[2]||(s[2]=o=>t.email=o),type:"email",class:"form-input",placeholder:"Enter email address"},null,512),[[p,t.email]])]),e("div",je,[s[16]||(s[16]=e("label",{class:"form-label"},"Phone Number",-1)),r(e("input",{"onUpdate:modelValue":s[3]||(s[3]=o=>t.phone=o),type:"tel",class:"form-input",placeholder:"Enter phone number"},null,512),[[p,t.phone]])]),s[24]||(s[24]=e("h4",{class:"section-title"},"Personal Address",-1)),e("div",Ie,[e("div",Ze,[s[17]||(s[17]=e("label",{class:"form-label"},"Country",-1)),r(e("input",{"onUpdate:modelValue":s[4]||(s[4]=o=>t.country=o),type:"text",class:"form-input",placeholder:"Enter country"},null,512),[[p,t.country]])]),e("div",Fe,[s[18]||(s[18]=e("label",{class:"form-label"},"City",-1)),r(e("input",{"onUpdate:modelValue":s[5]||(s[5]=o=>t.city=o),type:"text",class:"form-input",placeholder:"Enter city"},null,512),[[p,t.city]])])]),e("div",Te,[e("div",qe,[s[19]||(s[19]=e("label",{class:"form-label"},"Address",-1)),r(e("input",{"onUpdate:modelValue":s[6]||(s[6]=o=>t.address=o),type:"text",class:"form-input",placeholder:"Enter address"},null,512),[[p,t.address]])]),e("div",Oe,[s[20]||(s[20]=e("label",{class:"form-label"},"Zip Code",-1)),r(e("input",{"onUpdate:modelValue":s[7]||(s[7]=o=>t.zipCode=o),type:"text",class:"form-input",placeholder:"Enter zip code"},null,512),[[p,t.zipCode]])])]),s[25]||(s[25]=e("h4",{class:"section-title"},"Professional Information",-1)),e("div",Ye,[e("div",Ge,[s[21]||(s[21]=e("label",{class:"form-label"},"Certification Level",-1)),r(e("input",{"onUpdate:modelValue":s[8]||(s[8]=o=>t.certification_level=o),type:"text",class:"form-input",placeholder:"e.g., Q Grader, SCA Certified"},null,512),[[p,t.certification_level]])]),e("div",He,[s[22]||(s[22]=e("label",{class:"form-label"},"Experience Years",-1)),r(e("input",{"onUpdate:modelValue":s[9]||(s[9]=o=>t.experience_years=o),type:"number",class:"form-input",placeholder:"Years of experience",min:"0",max:"50"},null,512),[[p,t.experience_years,void 0,{number:!0}]])])]),e("div",Je,[s[23]||(s[23]=e("label",{class:"form-label"},"Bio",-1)),r(e("textarea",{"onUpdate:modelValue":s[10]||(s[10]=o=>t.bio=o),class:"form-textarea",placeholder:"Tell us about your coffee journey...",rows:"4"},null,512),[[p,t.bio]])]),e("div",Qe,[e("button",{type:"submit",class:"save-button",disabled:y.value},[y.value?(u(),d("span",Ke)):b("",!0),j(" "+f(y.value?"Saving...":"Save Changes"),1)],8,Xe)])],32)])])])):b("",!0),w.value==="preferences"?(u(),d("div",Re,s[26]||(s[26]=[e("div",{class:"preferences-content"},[e("h3",null,"Preferences"),e("p",null,"Customize your application preferences here.")],-1)]))):b("",!0),w.value==="security"?(u(),d("div",We,[e("div",{class:"security-content"},[s[28]||(s[28]=e("h3",null,"Security Settings",-1)),e("div",{class:"security-actions"},[e("button",{class:"action-button",onClick:V},s[27]||(s[27]=[J('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-fc3b77a9><rect x="3" y="11" width="18" height="11" rx="2" ry="2" data-v-fc3b77a9></rect><circle cx="12" cy="16" r="1" data-v-fc3b77a9></circle><path d="M7 11V7a5 5 0 0 1 10 0v4" data-v-fc3b77a9></path></svg><span data-v-fc3b77a9>Change Password</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-fc3b77a9><path d="M9 18l6-6-6-6" data-v-fc3b77a9></path></svg>',3)]))])])])):b("",!0),w.value==="privacy"?(u(),d("div",es,s[29]||(s[29]=[e("div",{class:"privacy-content"},[e("h3",null,"Data Privacy"),e("p",null,"Manage your data privacy settings here.")],-1)]))):b("",!0)])]),Y(ye,{modelValue:v.value,"onUpdate:modelValue":s[11]||(s[11]=o=>v.value=o),onSuccess:S},null,8,["modelValue"])]))}},os=I(ss,[["__scopeId","data-v-fc3b77a9"]]);export{os as P};
