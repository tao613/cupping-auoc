import{aw as o}from"./vue-vendor-BT5MiFnI.js";import{b as n}from"./index-BLlFbjoM.js";class i{async getSamples(e={}){try{return(await n.get("/samples/",{params:e})).data}catch(r){throw console.error("Error fetching samples:",r),this.handleError(r)}}async getSample(e){try{return(await n.get(`/samples/${e}`)).data}catch(r){throw console.error("Error fetching sample:",r),this.handleError(r)}}async createSample(e){try{return(await n.post("/samples/",e)).data}catch(r){throw console.error("Error creating sample:",r),this.handleError(r)}}async updateSample(e,r){try{return(await n.put(`/samples/${e}`,r)).data}catch(s){throw console.error("Error updating sample:",s),this.handleError(s)}}async deleteSample(e){try{return(await n.delete(`/samples/${e}`)).data}catch(r){throw console.error("Error deleting sample:",r),this.handleError(r)}}async restoreSample(e){try{return(await n.patch(`/samples/${e}/restore`)).data}catch(r){throw console.error("Error restoring sample:",r),this.handleError(r)}}async getSamplesStats(){try{return(await n.get("/samples/stats/overview")).data}catch(e){throw console.error("Error fetching samples stats:",e),this.handleError(e)}}async searchSamples(e,r={}){try{const s={search:e,...r};return(await n.get("/samples/",{params:s})).data}catch(s){throw console.error("Error searching samples:",s),this.handleError(s)}}getSampleTypeOptions(){return[{value:"arabica",label:"Arabica",description:"阿拉比卡"},{value:"robusta",label:"Robusta",description:"罗布斯塔"},{value:"blend",label:"Blend",description:"拼配"}]}getProcessingMethodOptions(){return[{value:"washed",label:"Washed",description:"水洗"},{value:"natural",label:"Natural",description:"日晒"},{value:"honey",label:"Honey",description:"蜜处理"},{value:"semi_washed",label:"Semi-Washed",description:"半水洗"}]}getRoastLevelOptions(){return[{value:"light",label:"Light",description:"浅烘"},{value:"medium_light",label:"Medium Light",description:"中浅烘"},{value:"medium",label:"Medium",description:"中烘"},{value:"medium_dark",label:"Medium Dark",description:"中深烘"},{value:"dark",label:"Dark",description:"深烘"}]}handleError(e){if(e.response){const{data:r,status:s}=e.response;switch(s){case 400:return new Error(r.detail||"请求参数错误");case 401:return new Error("认证失败，请重新登录");case 403:return new Error("权限不足");case 404:return new Error("样品不存在");case 409:return new Error("样品编号已存在");case 422:return new Error("数据验证失败");case 500:return new Error("服务器内部错误");default:return new Error(r.detail||"请求失败")}}else return e.request?new Error("网络连接失败，请检查网络设置"):new Error(e.message||"未知错误")}}const a=new i,h=o("samples",{state:()=>({samples:[],currentSample:null,loading:!1,error:null,pagination:{page:1,limit:10,total:0,total_pages:0,has_next:!1,has_prev:!1},stats:{total_samples:0,by_type:{},by_country:[]}}),getters:{getSampleById:t=>e=>t.samples.find(r=>r.id===e),activeSamples:t=>t.samples.filter(e=>e.is_active),samplesByCountry:t=>{const e={};return t.samples.forEach(r=>{e[r.country]||(e[r.country]=[]),e[r.country].push(r)}),e},samplesByType:t=>{const e={};return t.samples.forEach(r=>{e[r.sample_type]||(e[r.sample_type]=[]),e[r.sample_type].push(r)}),e}},actions:{async fetchSamples(t={}){this.loading=!0,this.error=null;try{const e=await a.getSamples({skip:((t.page||1)-1)*(t.limit||10),limit:t.limit||10,...t});return this.samples=e.data,this.pagination=e.pagination,e}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async fetchSampleById(t){this.loading=!0,this.error=null;try{const e=await a.getSample(t);this.currentSample=e;const r=this.samples.findIndex(s=>s.id===t);return r!==-1&&(this.samples[r]=e),e}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async createSample(t){this.loading=!0,this.error=null;try{const e=await a.createSample(t);return this.samples.unshift(e),this.pagination.total++,e}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async updateSample(t,e){this.loading=!0,this.error=null;try{const r=await a.updateSample(t,e),s=this.samples.findIndex(l=>l.id===t);return s!==-1&&(this.samples[s]=r),this.currentSample&&this.currentSample.id===t&&(this.currentSample=r),r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async deleteSample(t){this.loading=!0,this.error=null;try{await a.deleteSample(t);const e=this.samples.findIndex(r=>r.id===t);return e!==-1&&(this.samples.splice(e,1),this.pagination.total--),this.currentSample&&this.currentSample.id===t&&(this.currentSample=null),!0}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async restoreSample(t){this.loading=!0,this.error=null;try{const e=await a.restoreSample(t);return this.samples.unshift(e),this.pagination.total++,e}catch(e){throw this.error=e.message,e}finally{this.loading=!1}},async searchSamples(t,e={}){this.loading=!0,this.error=null;try{const r=await a.searchSamples(t,e);return this.samples=r.data,this.pagination=r.pagination,r}catch(r){throw this.error=r.message,r}finally{this.loading=!1}},async fetchSamplesStats(){try{const t=await a.getSamplesStats();return this.stats=t,t}catch(t){throw this.error=t.message,t}},clearError(){this.error=null},clearCurrentSample(){this.currentSample=null},getSampleOptions(){return{sampleTypes:a.getSampleTypeOptions(),processingMethods:a.getProcessingMethodOptions(),roastLevels:a.getRoastLevelOptions()}}}});export{h as u};
