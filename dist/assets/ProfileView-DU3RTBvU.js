import{r as P,X as B,c as g,w as F,y as u,J as b,z as c,A as e,V as D,I as n,aE as A,M as f,C as q,D as k,L as j,k as O,P as Y,O as G,a6 as H,ak as d,aD as J}from"./vue-vendor-BT5MiFnI.js";import{_ as I,u as T,a as Z}from"./index-BrO_L7mm.js";const Q={class:"dialog-content"},X={class:"field-group"},K={class:"password-input-wrapper"},R=["type"],W={class:"material-icons"},ee={class:"field-group"},se={class:"password-input-wrapper"},te=["type"],oe={class:"material-icons"},ae={class:"password-strength"},le={class:"strength-bar"},ie={class:"strength-text"},ne={class:"field-group"},re={class:"password-input-wrapper"},de=["type"],ue={class:"material-icons"},ce={key:0,class:"error-message"},pe={class:"password-tips"},ve={class:"dialog-actions"},me=["disabled"],fe={key:0,class:"material-icons loading-icon"},we={__name:"ChangePasswordDialog",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","success"],setup($,{emit:C}){const h=$,w=C,U=T(),y=Z(),v=P(!1),i=P(!1),t=P(!1),_=P(!1),l=B({currentPassword:"",newPassword:"",confirmPassword:""}),x=g(()=>{const m=l.newPassword;let o=0,r="weak",E="弱";return m.length>=6&&(o+=1),m.match(/[a-zA-Z]/)&&(o+=1),m.match(/[0-9]/)&&(o+=1),m.match(/[^a-zA-Z0-9]/)&&(o+=1),m.length>=12&&(o+=1),o>=4?(r="strong",E="强"):o>=2&&(r="medium",E="中等"),{level:r,text:E,percentage:o/5*100}}),V=g(()=>l.newPassword.length>=6),S=g(()=>/[a-zA-Z]/.test(l.newPassword)),z=g(()=>/[0-9]/.test(l.newPassword)),p=g(()=>/[^a-zA-Z0-9]/.test(l.newPassword)),s=g(()=>l.newPassword===l.confirmPassword),a=g(()=>l.currentPassword&&l.newPassword&&l.confirmPassword&&V.value&&s.value);F(()=>h.modelValue,m=>{m&&M()});const M=()=>{l.currentPassword="",l.newPassword="",l.confirmPassword="",i.value=!1,t.value=!1,_.value=!1},N=()=>{w("update:modelValue",!1)},L=async()=>{if(!(!a.value||v.value)){v.value=!0;try{await U.changePassword({current_password:l.currentPassword,new_password:l.newPassword}),y.showNotification({type:"success",message:"密码修改成功"}),w("success"),N()}catch(m){y.showNotification({type:"error",message:m.message||"密码修改失败，请重试"})}finally{v.value=!1}}};return(m,o)=>$.modelValue?(c(),u("div",{key:0,class:"dialog-overlay",onClick:N},[e("div",{class:"dialog-container",onClick:o[6]||(o[6]=D(()=>{},["stop"]))},[e("div",{class:"dialog-header"},[o[8]||(o[8]=e("h2",null,"修改密码",-1)),e("button",{class:"close-button",onClick:N},o[7]||(o[7]=[e("i",{class:"material-icons"},"close",-1)]))]),e("div",Q,[e("form",{onSubmit:D(L,["prevent"]),class:"password-form"},[e("div",X,[o[9]||(o[9]=e("label",{class:"field-label"},"当前密码",-1)),e("div",K,[n(e("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>l.currentPassword=r),type:i.value?"text":"password",class:"field-input",placeholder:"请输入当前密码",required:""},null,8,R),[[A,l.currentPassword]]),e("button",{type:"button",class:"password-toggle",onClick:o[1]||(o[1]=r=>i.value=!i.value)},[e("i",W,f(i.value?"visibility_off":"visibility"),1)])])]),e("div",ee,[o[10]||(o[10]=e("label",{class:"field-label"},"新密码",-1)),e("div",se,[n(e("input",{"onUpdate:modelValue":o[2]||(o[2]=r=>l.newPassword=r),type:t.value?"text":"password",class:"field-input",placeholder:"请输入新密码（至少6位）",minlength:"6",required:""},null,8,te),[[A,l.newPassword]]),e("button",{type:"button",class:"password-toggle",onClick:o[3]||(o[3]=r=>t.value=!t.value)},[e("i",oe,f(t.value?"visibility_off":"visibility"),1)])]),e("div",ae,[e("div",le,[e("div",{class:k(["strength-fill",x.value.level]),style:q({width:x.value.percentage+"%"})},null,6)]),e("span",ie,f(x.value.text),1)])]),e("div",ne,[o[11]||(o[11]=e("label",{class:"field-label"},"确认新密码",-1)),e("div",re,[n(e("input",{"onUpdate:modelValue":o[4]||(o[4]=r=>l.confirmPassword=r),type:_.value?"text":"password",class:"field-input",placeholder:"请再次输入新密码",required:""},null,8,de),[[A,l.confirmPassword]]),e("button",{type:"button",class:"password-toggle",onClick:o[5]||(o[5]=r=>_.value=!_.value)},[e("i",ue,f(_.value?"visibility_off":"visibility"),1)])]),l.confirmPassword&&!s.value?(c(),u("div",ce," 两次输入的密码不一致 ")):b("",!0)]),e("div",pe,[o[12]||(o[12]=e("h4",null,"密码要求：",-1)),e("ul",null,[e("li",{class:k({valid:V.value})},"至少6位字符",2),e("li",{class:k({valid:S.value})},"包含字母",2),e("li",{class:k({valid:z.value})},"包含数字",2),e("li",{class:k({valid:p.value})},"包含特殊字符（推荐）",2)])])],32)]),e("div",ve,[e("button",{type:"button",class:"cancel-button",onClick:N}," 取消 "),e("button",{type:"submit",class:"submit-button",disabled:!a.value||v.value,onClick:L},[v.value?(c(),u("i",fe,"hourglass_empty")):b("",!0),j(" "+f(v.value?"修改中...":"确认修改"),1)],8,me)])])])):b("",!0)}},ye=I(we,[["__scopeId","data-v-007650ef"]]),ge={class:"settings-view"},be={class:"settings-container"},he={class:"tab-navigation"},_e=["onClick"],Pe={class:"tab-content"},ke={key:0,class:"tab-pane"},Ce={class:"profile-form"},xe={class:"avatar-section"},Ve={class:"avatar-wrapper"},Ne={class:"avatar"},$e=["src","alt"],Ue={key:1,class:"avatar-placeholder"},Se={class:"user-info"},ze={class:"user-name"},Ee={class:"user-role"},Ae={class:"form-section"},De={class:"form-row"},Me={class:"form-group"},Le={class:"form-group"},Be={class:"form-group"},je={class:"form-group"},Ie={class:"form-group"},Te={class:"form-row"},Ze={class:"form-group"},Fe={class:"form-group"},qe={class:"form-row"},Oe={class:"form-group"},Ye={class:"form-group"},Ge={class:"form-row"},He={class:"form-group"},Je={class:"form-group"},Qe={class:"form-group"},Xe={class:"form-actions"},Ke=["disabled"],Re={key:0,class:"loading-spinner"},We={key:1,class:"tab-pane"},es={key:2,class:"tab-pane"},ss={key:3,class:"tab-pane"},ts={__name:"ProfileView",setup($){const C=T(),h=Z(),w=P("profile"),U=[{key:"profile",label:"Edit Profile"},{key:"preferences",label:"Preferences"},{key:"security",label:"Security"},{key:"privacy",label:"Data Privacy"}],y=P(!1),v=P(!1),i=g(()=>C.user),t=B({firstName:"",lastName:"",name:"",username:"",email:"",phone:"",country:"",city:"",address:"",zipCode:"",certification_level:"",experience_years:null,bio:"",avatar:""});O(()=>{_()});const _=async()=>{try{await C.refreshUserInfo();const s=(i.value.name||"").split(" ");Object.assign(t,{firstName:s[0]||"",lastName:s.slice(1).join(" ")||"",name:i.value.name||"",username:i.value.username||"",email:i.value.email||"",phone:i.value.phone||"",country:i.value.country||"",city:i.value.city||"",address:i.value.address||"",zipCode:i.value.zipCode||"",certification_level:i.value.certification_level||"",experience_years:i.value.experience_years||null,bio:i.value.bio||"",avatar:i.value.avatar||""})}catch{h.showNotification({type:"error",message:"Failed to load user information"})}},l=async()=>{y.value=!0;try{const p=`${t.firstName} ${t.lastName}`.trim(),s={...t,name:p};await C.updateProfile(s),h.showNotification({type:"success",message:"Profile updated successfully"})}catch(p){h.showNotification({type:"error",message:p.message||"Update failed, please try again"})}finally{y.value=!1}},x=()=>{h.showNotification({type:"info",message:"Avatar upload feature coming soon"})},V=()=>{v.value=!0},S=()=>{h.showNotification({type:"success",message:"Password changed successfully"})},z=p=>p?p.split(" ").map(s=>s.charAt(0)).join("").toUpperCase().slice(0,2):"U";return(p,s)=>(c(),u("div",ge,[e("div",be,[s[33]||(s[33]=e("div",{class:"page-header"},[e("h1",{class:"page-title"},"Setting")],-1)),e("div",he,[(c(),u(G,null,H(U,a=>e("button",{key:a.key,class:k(["tab-button",{active:w.value===a.key}]),onClick:M=>w.value=a.key},f(a.label),11,_e)),64))]),e("div",Pe,[w.value==="profile"?(c(),u("div",ke,[e("div",Ce,[e("div",xe,[e("div",Ve,[e("div",Ne,[t.avatar?(c(),u("img",{key:0,src:t.avatar,alt:t.name||"User Avatar"},null,8,$e)):(c(),u("div",Ue,f(z(t.name||i.value.name)),1))]),e("button",{class:"avatar-edit-btn",onClick:x},s[13]||(s[13]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}),e("circle",{cx:"12",cy:"13",r:"4"})],-1)]))]),e("div",Se,[e("h3",ze,f(t.name||i.value.name||"User"),1),e("p",Ee,f(t.certification_level||"Coffee Enthusiast"),1)])]),e("div",Ae,[e("form",{onSubmit:D(l,["prevent"])},[e("div",De,[e("div",Me,[s[14]||(s[14]=e("label",{class:"form-label"},"First Name",-1)),n(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.firstName=a),type:"text",class:"form-input",placeholder:"Enter first name"},null,512),[[d,t.firstName]])]),e("div",Le,[s[15]||(s[15]=e("label",{class:"form-label"},"Last Name",-1)),n(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>t.lastName=a),type:"text",class:"form-input",placeholder:"Enter last name"},null,512),[[d,t.lastName]])])]),e("div",Be,[s[16]||(s[16]=e("label",{class:"form-label"},"Username (Login Name)",-1)),n(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>t.username=a),type:"text",class:"form-input",placeholder:"Enter username for login"},null,512),[[d,t.username]]),s[17]||(s[17]=e("div",{class:"form-hint"},"This is the name you use to log in to the system",-1))]),e("div",je,[s[18]||(s[18]=e("label",{class:"form-label"},"Email Address",-1)),n(e("input",{"onUpdate:modelValue":s[3]||(s[3]=a=>t.email=a),type:"email",class:"form-input",placeholder:"Enter email address"},null,512),[[d,t.email]])]),e("div",Ie,[s[19]||(s[19]=e("label",{class:"form-label"},"Phone Number",-1)),n(e("input",{"onUpdate:modelValue":s[4]||(s[4]=a=>t.phone=a),type:"tel",class:"form-input",placeholder:"Enter phone number"},null,512),[[d,t.phone]])]),s[27]||(s[27]=e("h4",{class:"section-title"},"Personal Address",-1)),e("div",Te,[e("div",Ze,[s[20]||(s[20]=e("label",{class:"form-label"},"Country",-1)),n(e("input",{"onUpdate:modelValue":s[5]||(s[5]=a=>t.country=a),type:"text",class:"form-input",placeholder:"Enter country"},null,512),[[d,t.country]])]),e("div",Fe,[s[21]||(s[21]=e("label",{class:"form-label"},"City",-1)),n(e("input",{"onUpdate:modelValue":s[6]||(s[6]=a=>t.city=a),type:"text",class:"form-input",placeholder:"Enter city"},null,512),[[d,t.city]])])]),e("div",qe,[e("div",Oe,[s[22]||(s[22]=e("label",{class:"form-label"},"Address",-1)),n(e("input",{"onUpdate:modelValue":s[7]||(s[7]=a=>t.address=a),type:"text",class:"form-input",placeholder:"Enter address"},null,512),[[d,t.address]])]),e("div",Ye,[s[23]||(s[23]=e("label",{class:"form-label"},"Zip Code",-1)),n(e("input",{"onUpdate:modelValue":s[8]||(s[8]=a=>t.zipCode=a),type:"text",class:"form-input",placeholder:"Enter zip code"},null,512),[[d,t.zipCode]])])]),s[28]||(s[28]=e("h4",{class:"section-title"},"Professional Information",-1)),e("div",Ge,[e("div",He,[s[24]||(s[24]=e("label",{class:"form-label"},"Certification Level",-1)),n(e("input",{"onUpdate:modelValue":s[9]||(s[9]=a=>t.certification_level=a),type:"text",class:"form-input",placeholder:"e.g., Q Grader, SCA Certified"},null,512),[[d,t.certification_level]])]),e("div",Je,[s[25]||(s[25]=e("label",{class:"form-label"},"Experience Years",-1)),n(e("input",{"onUpdate:modelValue":s[10]||(s[10]=a=>t.experience_years=a),type:"number",class:"form-input",placeholder:"Years of experience",min:"0",max:"50"},null,512),[[d,t.experience_years,void 0,{number:!0}]])])]),e("div",Qe,[s[26]||(s[26]=e("label",{class:"form-label"},"Bio",-1)),n(e("textarea",{"onUpdate:modelValue":s[11]||(s[11]=a=>t.bio=a),class:"form-textarea",placeholder:"Tell us about your coffee journey...",rows:"4"},null,512),[[d,t.bio]])]),e("div",Xe,[e("button",{type:"submit",class:"save-button",disabled:y.value},[y.value?(c(),u("span",Re)):b("",!0),j(" "+f(y.value?"Saving...":"Save Changes"),1)],8,Ke)])],32)])])])):b("",!0),w.value==="preferences"?(c(),u("div",We,s[29]||(s[29]=[e("div",{class:"preferences-content"},[e("h3",null,"Preferences"),e("p",null,"Customize your application preferences here.")],-1)]))):b("",!0),w.value==="security"?(c(),u("div",es,[e("div",{class:"security-content"},[s[31]||(s[31]=e("h3",null,"Security Settings",-1)),e("div",{class:"security-actions"},[e("button",{class:"action-button",onClick:V},s[30]||(s[30]=[J('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-25662fe3><rect x="3" y="11" width="18" height="11" rx="2" ry="2" data-v-25662fe3></rect><circle cx="12" cy="16" r="1" data-v-25662fe3></circle><path d="M7 11V7a5 5 0 0 1 10 0v4" data-v-25662fe3></path></svg><span data-v-25662fe3>Change Password</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-25662fe3><path d="M9 18l6-6-6-6" data-v-25662fe3></path></svg>',3)]))])])])):b("",!0),w.value==="privacy"?(c(),u("div",ss,s[32]||(s[32]=[e("div",{class:"privacy-content"},[e("h3",null,"Data Privacy"),e("p",null,"Manage your data privacy settings here.")],-1)]))):b("",!0)])]),Y(ye,{modelValue:v.value,"onUpdate:modelValue":s[12]||(s[12]=a=>v.value=a),onSuccess:S},null,8,["modelValue"])]))}},ls=I(ts,[["__scopeId","data-v-25662fe3"]]);export{ls as P};
